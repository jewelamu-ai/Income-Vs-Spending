<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker Pro - Cloud Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .tab-active { color: #4f46e5; font-weight: 600; }
        .tab-active svg { stroke: #4f46e5; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #4f46e5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-purple-50 min-h-screen">
    
    <!-- Firebase Configuration Notice -->
    <div id="firebaseNotice" class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
        <div class="max-w-6xl mx-auto">
            <p class="text-sm text-yellow-700">
                ‚ö†Ô∏è <strong>Firebase Setup Required:</strong> Please configure your Firebase credentials in the JavaScript section below. 
                <a href="#setup-instructions" class="underline font-semibold">See setup instructions</a>
            </p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Budget Tracker Pro</h1>
                <p class="text-gray-600">Cloud-synced expense tracking</p>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="space-y-4">
                <input type="email" id="loginEmail" placeholder="Email" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                <input type="password" id="loginPassword" placeholder="Password" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                <button onclick="loginUser()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                    Sign In
                </button>
                <button onclick="showRegisterForm()" class="w-full bg-white text-indigo-600 border-2 border-indigo-600 py-3 rounded-lg font-semibold hover:bg-indigo-50">
                    Create Account
                </button>
                <div id="loginError" class="text-red-600 text-sm text-center hidden"></div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="space-y-4 hidden">
                <input type="email" id="registerEmail" placeholder="Email" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                <input type="password" id="registerPassword" placeholder="Password (min 6 characters)" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                <input type="password" id="registerPasswordConfirm" placeholder="Confirm Password" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                <button onclick="registerUser()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                    Create Account
                </button>
                <button onclick="showLoginForm()" class="w-full bg-white text-gray-600 border-2 border-gray-300 py-3 rounded-lg font-semibold hover:bg-gray-50">
                    Back to Login
                </button>
                <div id="registerError" class="text-red-600 text-sm text-center hidden"></div>
            </div>

            <!-- Loading Spinner -->
            <div id="authLoading" class="hidden text-center">
                <div class="spinner mx-auto mb-4"></div>
                <p class="text-gray-600">Please wait...</p>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden until logged in) -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg">
            <div class="max-w-6xl mx-auto p-4">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-2">
                        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                        <h1 class="text-2xl font-bold">Budget Tracker Pro</h1>
                    </div>
                    <div class="flex gap-2 items-center">
                        <span id="userEmail" class="text-sm opacity-90 hidden md:block"></span>
                        <button onclick="openSettingsModal()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg text-sm">Settings</button>
                        <button onclick="exportData()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg text-sm">Export</button>
                        <button onclick="logoutUser()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg text-sm">Logout</button>
                    </div>
                </div>

                <!-- Sync Status -->
                <div id="syncStatus" class="text-xs opacity-75 mb-3 flex items-center gap-2">
                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                    <span>Synced</span>
                </div>

                <!-- Account Selector -->
                <div class="mb-4">
                    <select id="accountSelector" onchange="switchAccount()" class="bg-white/20 text-white border border-white/30 rounded-lg px-4 py-2 w-full backdrop-blur-sm">
                        <option value="default">All Accounts</option>
                    </select>
                </div>

                <!-- Balance Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-4 text-white shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-sm opacity-90">Income</div>
                            <svg class="w-6 h-6 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                        <p id="totalIncome" class="text-2xl font-bold">GHS0.00</p>
                        <div class="text-xs opacity-75 mt-1">This month</div>
                    </div>
                    <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-2xl p-4 text-white shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-sm opacity-90">Expenses</div>
                            <svg class="w-6 h-6 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <p id="totalExpense" class="text-2xl font-bold">GHS0.00</p>
                        <div class="text-xs opacity-75 mt-1">This month</div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 text-white shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-sm opacity-90">Balance</div>
                            <svg class="w-6 h-6 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                        <p id="balance" class="text-2xl font-bold">GHS0.00</p>
                        <div class="text-xs opacity-75 mt-1">Available</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-4 text-white shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-sm opacity-90">Budget Left</div>
                            <svg class="w-6 h-6 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <p id="budgetLeft" class="text-2xl font-bold">GHS0.00</p>
                        <div class="text-xs opacity-75 mt-1">Remaining</div>
                    </div>
                </div>

                <!-- Welcome Section -->
                <div class="mt-6 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-lg font-semibold">Welcome back!</h2>
                            <p class="text-indigo-100 text-sm">Here's your financial overview</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm opacity-90" id="currentDate"></p>
                            <p class="text-xs opacity-75">Today</p>
                        </div>
                    </div>
                </div>

                <!-- Financial Position Section -->
                <div class="mt-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Financial Position</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Income Sources -->
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                    </svg>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-800">Income Sources</h4>
                            </div>
                            <div id="incomeSourcesList" class="space-y-3">
                                <!-- Income sources will be populated here -->
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-700">Total Assets</span>
                                    <span id="totalAssetsValue" class="font-bold text-green-600 text-lg">GHS0.00</span>
                                </div>
                            </div>
                        </div>

                        <!-- Liabilities -->
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3">
                                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                </div>
                                <h4 class="text-lg font-semibold text-gray-800">Liabilities</h4>
                            </div>
                            <div id="liabilitiesList" class="space-y-3">
                                <!-- Liabilities will be populated here -->
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-700">Total Liabilities</span>
                                    <span id="totalLiabilitiesValue" class="font-bold text-red-600 text-lg">GHS0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Net Worth Summary -->
                    <div class="mt-6 bg-gradient-to-r from-gray-800 to-gray-900 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="text-lg font-semibold">Net Worth</h4>
                                <p class="text-gray-300 text-sm">Assets minus Liabilities</p>
                            </div>
                            <div class="text-right">
                                <p id="netWorthValue" class="text-3xl font-bold">GHS0.00</p>
                                <p class="text-sm text-gray-300">Current Position</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-30">
            <div class="max-w-6xl mx-auto flex">
                <button onclick="switchTab('transactions')" id="tabTransactions" class="tab-active flex-1 py-3 px-2 flex flex-col items-center justify-center text-xs">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                    <span>Transactions</span>
                </button>
                <button onclick="switchTab('budgets')" id="tabBudgets" class="flex-1 py-3 px-2 flex flex-col items-center justify-center text-xs text-gray-600">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    <span>Budgets</span>
                </button>
                <button onclick="switchTab('analytics')" id="tabAnalytics" class="flex-1 py-3 px-2 flex flex-col items-center justify-center text-xs text-gray-600">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    <span>Analytics</span>
                </button>
                <button onclick="switchTab('assets')" id="tabAssets" class="flex-1 py-3 px-2 flex flex-col items-center justify-center text-xs text-gray-600">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                    <span>Assets</span>
                </button>
                <button onclick="switchTab('accounts')" id="tabAccounts" class="flex-1 py-3 px-2 flex flex-col items-center justify-center text-xs text-gray-600">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                    <span>Accounts</span>
                </button>
                <button onclick="switchTab('reminders')" id="tabReminders" class="flex-1 py-3 px-2 flex flex-col items-center justify-center text-xs text-gray-600">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>Reminders</span>
                </button>
            </div>
        </div>

        <!-- Main Content Container -->
        <div class="max-w-6xl mx-auto p-4 pb-20">
            <!-- Transactions Tab -->
            <div id="contentTransactions" class="tab-content">
                <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                    <div class="flex gap-2">
                        <button onclick="setFilter('all')" id="filterAll" class="px-3 py-2 text-sm rounded-lg bg-indigo-600 text-white">All</button>
                        <button onclick="setFilter('income')" id="filterIncome" class="px-3 py-2 text-sm rounded-lg bg-white text-gray-700">Income</button>
                        <button onclick="setFilter('expense')" id="filterExpense" class="px-3 py-2 text-sm rounded-lg bg-white text-gray-700">Expense</button>
                        <button onclick="setFilter('transfer')" id="filterTransfer" class="px-3 py-2 text-sm rounded-lg bg-white text-gray-700">Transfers</button>
                    </div>
                    <div class="flex gap-2 items-center">
                        <input type="text" id="searchInput" placeholder="Search transactions..." class="px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" oninput="handleSearch()">
                        <button onclick="openTransactionModal()" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">+ Add</button>
                    </div>
                </div>
                <div id="transactionsList" class="bg-white rounded-xl shadow-md"></div>
            </div>

            <!-- Budgets Tab -->
            <div id="contentBudgets" class="tab-content hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Category Budgets</h2>
                    <button onclick="openBudgetModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm">+ Add Budget</button>
                </div>
                <div id="budgetsList"></div>
            </div>

            <!-- Analytics Tab -->
            <div id="contentAnalytics" class="tab-content hidden">
                <div class="mb-4">
                    <select id="analyticsType" class="px-4 py-2 border rounded-lg">
                        <option value="category">By Category</option>
                        <option value="monthly">Monthly Trend</option>
                        <option value="comparison">Income vs Expense</option>
                    </select>
                </div>
                <div class="bg-white rounded-xl shadow-md p-4">
                    <canvas id="analyticsChart"></canvas>
                </div>
                <div id="analyticsSummary" class="mt-4"></div>
            </div>

            <!-- Recurring Tab -->
            <div id="contentRecurring" class="tab-content hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Recurring Transactions</h2>
                    <button onclick="openRecurringModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm">+ Add Recurring</button>
                </div>
                <div id="recurringList"></div>
            </div>

            <!-- Assets Tab -->
            <div id="contentAssets" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Asset Manager</h2>
                    <p class="text-gray-600">Track your valuable assets and investments</p>
                </div>

                <!-- Asset Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 text-white shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-sm opacity-90">Total Assets</div>
                            <svg class="w-6 h-6 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                        </div>
                        <p id="totalAssetsValue" class="text-2xl font-bold">GHS0.00</p>
                        <div class="text-xs opacity-75 mt-1">All assets combined</div>
                    </div>
                    <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-4 text-white shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-sm opacity-90">Real Estate</div>
                            <svg class="w-6 h-6 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                        </div>
                        <p id="realEstateValue" class="text-2xl font-bold">GHS0.00</p>
                        <div class="text-xs opacity-75 mt-1">Properties & land</div>
                    </div>
                    <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-4 text-white shadow-lg">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-sm opacity-90">Investments</div>
                            <svg class="w-6 h-6 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                        </div>
                        <p id="investmentsValue" class="text-2xl font-bold">GHS0.00</p>
                        <div class="text-xs opacity-75 mt-1">Stocks & investments</div>
                    </div>
                </div>

                <!-- Add Asset Button -->
                <div class="mb-4 flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-800">Your Assets</h3>
                    <button onclick="openAssetModal()" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:shadow-lg transition-shadow">
                        + Add Asset
                    </button>
                </div>

                <!-- Assets List -->
                <div id="assetsList"></div>
            </div>

            <!-- Accounts Tab -->
            <div id="contentAccounts" class="tab-content hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Accounts & Assets</h2>
                    <button onclick="openAccountModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm">+ Add Account</button>
                </div>
                <div id="accountsList"></div>
            </div>

            <!-- Reminders Tab -->
            <div id="contentReminders" class="tab-content hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Bill Reminders</h2>
                    <button onclick="openReminderModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm">+ Add Reminder</button>
                </div>
                <div id="remindersList"></div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button onclick="openTransactionModal()" class="fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full shadow-lg hover:shadow-xl transition-shadow flex items-center justify-center z-40">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
    </button>

    <!-- All Modals (Transaction, Budget, Account, Reminder) - Same as before -->
    <div id="transactionModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-6 my-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Add Transaction</h2>
                <button onclick="closeTransactionModal()" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Transaction Type Selection -->
            <div class="mb-6">
                <div class="grid grid-cols-3 gap-3">
                    <button onclick="setType('income')" id="typeIncome" class="p-4 rounded-2xl border-2 border-gray-200 hover:border-green-300 transition-colors group">
                        <div class="flex flex-col items-center space-y-2">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center group-hover:bg-green-200 transition-colors">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                </svg>
                            </div>
                            <span class="font-medium text-gray-700">Income</span>
                        </div>
                    </button>
                    <button onclick="setType('expense')" id="typeExpense" class="p-4 rounded-2xl border-2 border-red-500 bg-red-50 text-red-700">
                        <div class="flex flex-col items-center space-y-2">
                            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <span class="font-medium">Expense</span>
                        </div>
                    </button>
                    <button onclick="setType('transfer')" id="typeTransfer" class="p-4 rounded-2xl border-2 border-gray-200 hover:border-blue-300 transition-colors group">
                        <div class="flex flex-col items-center space-y-2">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center group-hover:bg-blue-200 transition-colors">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                </svg>
                            </div>
                            <span class="font-medium text-gray-700">Transfer</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Form Fields -->
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 font-medium">GHS</span>
                        <input type="number" id="amount" step="0.01" placeholder="0.00" class="w-full pl-16 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-lg">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select id="category" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></select>
                </div>

                <div id="accountField">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Account</label>
                    <select id="accountSelect" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></select>
                </div>

                <div id="transferFields" class="hidden">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">From Account</label>
                            <select id="fromAccountSelect" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">To Account</label>
                            <select id="toAccountSelect" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></select>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                    <input type="date" id="date" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <input type="text" id="description" placeholder="What was this for?" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <button onclick="addTransaction()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-xl font-semibold text-lg hover:shadow-lg transition-shadow mt-6">
                    Add Transaction
                </button>
            </div>
        </div>
    </div>

    <div id="budgetModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Set Budget</h2>
                <button onclick="closeBudgetModal()" class="text-gray-400 hover:text-gray-600">‚úï</button>
            </div>
            <div class="space-y-3">
                <select id="budgetCategory" class="w-full px-4 py-3 border rounded-lg"></select>
                <input type="number" id="budgetAmount" step="0.01" placeholder="Budget Amount" class="w-full px-4 py-3 border rounded-lg">
                <select id="budgetPeriod" class="w-full px-4 py-3 border rounded-lg">
                    <option value="monthly">Monthly</option>
                    <option value="weekly">Weekly</option>
                    <option value="yearly">Yearly</option>
                </select>
                <button onclick="addBudget()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold">Set Budget</button>
            </div>
        </div>
    </div>

    <div id="accountModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-6 my-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Add Account</h2>
                <button onclick="closeAccountModal()" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Form Fields -->
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Account Name</label>
                    <input type="text" id="accountName" placeholder="e.g., Main Checking, Savings" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Account Type</label>
                    <select id="accountType" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="cash">üíµ Cash</option>
                        <option value="bank">üè¶ Bank Account</option>
                        <option value="credit">üí≥ Credit Card</option>
                        <option value="mtn-momo">üì± MTN MoMo</option>
                        <option value="telecel-cash">üìû Telecel Cash</option>
                        <option value="investment">üìà Investment</option>
                        <option value="asset">üè† Asset</option>
                        <option value="debt">üí∞ Debt</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Initial Balance</label>
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 font-medium">GHS</span>
                        <input type="number" id="accountBalance" step="0.01" placeholder="0.00" class="w-full pl-16 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>

                <button onclick="addAccount()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-xl font-semibold text-lg hover:shadow-lg transition-shadow mt-6">
                    Add Account
                </button>
            </div>
        </div>
    </div>

    <!-- Asset Modal -->
    <div id="assetModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-6 my-8">
            <div class="flex justify-between items-center mb-6">
                <h2 id="assetModalTitle" class="text-2xl font-bold text-gray-800">Add New Asset</h2>
                <button onclick="closeAssetModal()" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Form Fields -->
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Asset Name</label>
                    <input type="text" id="assetName" placeholder="e.g., Toyota Camry, House, Gold Watch" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select id="assetCategory" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="real-estate">üè† Real Estate</option>
                        <option value="vehicle">üöó Vehicle</option>
                        <option value="investment">üìà Investment</option>
                        <option value="jewelry">üíç Jewelry</option>
                        <option value="other">üì¶ Other</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Current Value</label>
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 font-medium">GHS</span>
                        <input type="number" id="assetValue" step="0.01" placeholder="0.00" class="w-full pl-16 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Purchase Date</label>
                    <input type="date" id="assetPurchaseDate" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description (Optional)</label>
                    <textarea id="assetDescription" rows="3" placeholder="Additional details about the asset..." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none"></textarea>
                </div>

                <button id="assetSubmitBtn" onclick="addAsset()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-xl font-semibold text-lg hover:shadow-lg transition-shadow mt-6">
                    Add Asset
                </button>
            </div>
        </div>
    </div>

    <div id="reminderModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Add Reminder</h2>
                <button onclick="closeReminderModal()" class="text-gray-400 hover:text-gray-600">‚úï</button>
            </div>
            <div class="space-y-3">
                <input type="text" id="reminderTitle" placeholder="Bill Name (e.g., Electricity, Rent)" class="w-full px-4 py-3 border rounded-lg">
                <input type="number" id="reminderAmount" step="0.01" placeholder="Expected Amount" class="w-full px-4 py-3 border rounded-lg">
                <input type="date" id="reminderDate" class="w-full px-4 py-3 border rounded-lg">
                <select id="reminderFrequency" class="w-full px-4 py-3 border rounded-lg">
                    <option value="once">One-time</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                </select>
                <button onclick="addReminder()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold">Add Reminder</button>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Settings</h2>
                <button onclick="closeSettingsModal()" class="text-gray-400 hover:text-gray-600">‚úï</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Currency</label>
                    <select id="currencySelect" class="w-full px-4 py-3 border rounded-lg">
                        <option value="GHS">GHS - Ghanaian Cedi</option>
                        <option value="USD">USD - US Dollar</option>
                        <option value="EUR">EUR - Euro</option>
                        <option value="GBP">GBP - British Pound</option>
                        <option value="JPY">JPY - Japanese Yen</option>
                        <option value="CAD">CAD - Canadian Dollar</option>
                        <option value="AUD">AUD - Australian Dollar</option>
                    </select>
                </div>
                <button onclick="saveSettings()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold">Save Settings</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        // REPLACE THESE VALUES WITH YOUR OWN FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAocH0mqZA5iUXgq_BeTfGqV1cuUbWRntY",
    authDomain: "budget-tracker-91bcc.firebaseapp.com",
    databaseURL: "https://budget-tracker-91bcc-default-rtdb.firebaseio.com",
    projectId: "budget-tracker-91bcc",
    storageBucket: "budget-tracker-91bcc.firebasestorage.app",
    messagingSenderId: "657417341954",
    appId: "1:657417341954:web:08972dae3623bdd61f6b1b",
    measurementId: "G-BV3C6NY0B1"
        };

        // Initialize Firebase
        let app, auth, db, currentUser = null;
        
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            console.log('Firebase initialized successfully');
            document.getElementById('firebaseNotice').classList.add('hidden');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            alert('Firebase configuration needed. Please see setup instructions below.');
        }

        // ============================================
        // APP STATE
        // ============================================
        let transactions = [];
        let budgets = [];
        let accounts = [{id: 'default', name: 'Cash', type: 'cash', balance: 0}];
        let recurring = [];
        let reminders = [];
        let assets = [];
        let currentFilter = 'all';
        let currentType = 'expense';
        let currentTab = 'transactions';
        let currentAccount = 'default';
        let currency = 'GHS';
        let analyticsChart = null;

        const categories = {
            income: ['Salary', 'Freelance', 'Business', 'Investment', 'Gift', 'Other'],
            expense: ['Food', 'Transport', 'Shopping', 'Bills', 'Entertainment', 'Health', 'Education', 'Other']
        };

        // ============================================
        // AUTHENTICATION
        // ============================================
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('userEmail').textContent = user.email;
                loadFirebaseData();
            } else {
                currentUser = null;
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
        });

        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        async function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');

            if (!email || !password) {
                errorEl.textContent = 'Please enter email and password';
                errorEl.classList.remove('hidden');
                return;
            }

            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('authLoading').classList.remove('hidden');

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.classList.remove('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('authLoading').classList.add('hidden');
            }
        }

        async function registerUser() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            const errorEl = document.getElementById('registerError');

            if (!email || !password) {
                errorEl.textContent = 'Please enter email and password';
                errorEl.classList.remove('hidden');
                return;
            }

            if (password.length < 6) {
                errorEl.textContent = 'Password must be at least 6 characters';
                errorEl.classList.remove('hidden');
                return;
            }

            if (password !== passwordConfirm) {
                errorEl.textContent = 'Passwords do not match';
                errorEl.classList.remove('hidden');
                return;
            }

            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('authLoading').classList.remove('hidden');

            try {
                await auth.createUserWithEmailAndPassword(email, password);
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.classList.remove('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
                document.getElementById('authLoading').classList.add('hidden');
            }
        }

        async function logoutUser() {
            if (confirm('Are you sure you want to logout?')) {
                await auth.signOut();
            }
        }

        // ============================================
        // FIREBASE DATA OPERATIONS
        // ============================================
        function setSyncStatus(message, isError = false) {
            const el = document.getElementById('syncStatus');
            el.innerHTML = `
                <div class="w-2 h-2 ${isError ? 'bg-red-400' : 'bg-green-400'} rounded-full"></div>
                <span>${message}</span>
            `;
        }

        async function loadFirebaseData() {
            if (!currentUser) return;
            
            setSyncStatus('Loading...');
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                
                if (userDoc.exists) {
                    const data = userDoc.data();
                    transactions = data.transactions || [];
                    budgets = data.budgets || [];
                    accounts = data.accounts || [{id: 'default', name: 'Cash', type: 'cash', balance: 0}];
                    recurring = data.recurring || [];
                    reminders = data.reminders || [];
                    assets = data.assets || [];
                    currency = data.currency || 'GHS';
                }
                
                init();
                setSyncStatus('Synced');
            } catch (error) {
                console.error('Load error:', error);
                setSyncStatus('Error loading data', true);
            }
        }

        async function saveToFirebase() {
            if (!currentUser) return;
            
            setSyncStatus('Syncing...');
            
            try {
                await db.collection('users').doc(currentUser.uid).set({
                    transactions,
                    budgets,
                    accounts,
                    recurring,
                    reminders,
                    assets,
                    currency,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                setSyncStatus('Synced');
            } catch (error) {
                console.error('Save error:', error);
                setSyncStatus('Sync failed', true);
            }
        }

        // ============================================
        // APP INITIALIZATION
        // ============================================
        function init() {
            document.getElementById('date').valueAsDate = new Date();
            updateCategories();
            updateAccountSelectors();
            renderTransactions();
            updateTotals();
            // Initialize currency select
            const currencySelect = document.getElementById('currencySelect');
            if (currencySelect) currencySelect.value = currency;
            // Initialize analytics select event listener
            const analyticsSelect = document.getElementById('analyticsType');
            if (analyticsSelect) {
                analyticsSelect.addEventListener('change', updateAnalytics);
            }
            // Initialize current date
            const dateEl = document.getElementById('currentDate');
            if (dateEl) {
                const now = new Date();
                dateEl.textContent = now.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
        }

        // ============================================
        // CORE FUNCTIONS (Same as before but with saveToFirebase())
        // ============================================
        function setType(type) {
            currentType = type;
            
            // Update button styles
            document.getElementById('typeIncome').className = type === 'income'
                ? 'p-4 rounded-2xl border-2 border-green-500 bg-green-50 text-green-700'
                : 'p-4 rounded-2xl border-2 border-gray-200 hover:border-green-300 transition-colors group';
            document.getElementById('typeExpense').className = type === 'expense'
                ? 'p-4 rounded-2xl border-2 border-red-500 bg-red-50 text-red-700'
                : 'p-4 rounded-2xl border-2 border-gray-200 hover:border-red-300 transition-colors group';
            document.getElementById('typeTransfer').className = type === 'transfer'
                ? 'p-4 rounded-2xl border-2 border-blue-500 bg-blue-50 text-blue-700'
                : 'p-4 rounded-2xl border-2 border-gray-200 hover:border-blue-300 transition-colors group';
            
            // Show/hide fields based on type
            const categoryField = document.getElementById('category').parentElement;
            const accountField = document.getElementById('accountField');
            const transferFields = document.getElementById('transferFields');
            
            if (type === 'transfer') {
                categoryField.style.display = 'none';
                accountField.classList.add('hidden');
                transferFields.classList.remove('hidden');
            } else {
                categoryField.style.display = 'block';
                accountField.classList.remove('hidden');
                transferFields.classList.add('hidden');
            }
            
            updateCategories();
        }

        function updateCategories() {
            const select = document.getElementById('category');
            const budgetSelect = document.getElementById('budgetCategory');
            select.innerHTML = '<option value="">Select category</option>';
            budgetSelect.innerHTML = '<option value="">Select category</option>';
            categories[currentType].forEach(cat => {
                select.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
            categories.expense.forEach(cat => {
                budgetSelect.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
        }
        function updateAccountSelectors() {
            const selectors = ['accountSelect', 'accountSelector', 'fromAccountSelect', 'toAccountSelect'];
            selectors.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                const current = el.value || 'default';
                el.innerHTML = '';
                accounts.forEach(acc => {
                    el.innerHTML += `<option value="${acc.id}">${acc.name}</option>`;
                });
                try { el.value = current; } catch (e) { /* ignore */ }
            });
        }

            // Minimal safe stubs so the page can initialize without throwing
            function renderReminders() {
                const el = document.getElementById('remindersList');
                if (!el) return;

                if (!reminders || reminders.length === 0) {
                    el.innerHTML = `
                        <div class="text-center py-8">
                            <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <p class="text-gray-500 text-lg">No reminders yet</p>
                            <p class="text-gray-400 text-sm">Add your first bill reminder to get started</p>
                        </div>
                    `;
                    return;
                }

                el.innerHTML = reminders.map(reminder => {
                    const reminderDate = new Date(reminder.date);
                    const today = new Date();
                    const daysUntil = Math.ceil((reminderDate - today) / (1000 * 60 * 60 * 24));
                    
                    let statusColor = 'bg-green-100 text-green-800';
                    let statusText = 'Upcoming';
                    
                    if (daysUntil < 0) {
                        statusColor = 'bg-red-100 text-red-800';
                        statusText = 'Overdue';
                    } else if (daysUntil <= 3) {
                        statusColor = 'bg-yellow-100 text-yellow-800';
                        statusText = 'Due Soon';
                    }

                    return `
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-900">${reminder.title}</p>
                                        <p class="text-sm text-gray-500 capitalize">${reminder.frequency} ‚Ä¢ ${reminderDate.toLocaleDateString()}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-lg text-gray-900">${currency}${Number(reminder.amount || 0).toFixed(2)}</p>
                                    <span class="inline-block px-2 py-1 text-xs rounded-full ${statusColor} mt-1">
                                        ${statusText}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            function renderTransactions() {
                const el = document.getElementById('transactionsList');
                if (!el) return;
                if (!transactions || transactions.length === 0) {
                    el.innerHTML = `
                        <div class="text-center py-8">
                            <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            <p class="text-gray-500 text-lg">No transactions yet</p>
                            <p class="text-gray-400 text-sm">Add your first transaction to get started</p>
                        </div>
                    `;
                    return;
                }

                // Filter transactions based on current filter
                let filteredTransactions = transactions;
                if (currentFilter === 'income') {
                    filteredTransactions = transactions.filter(t => t.type === 'income');
                } else if (currentFilter === 'expense') {
                    filteredTransactions = transactions.filter(t => t.type === 'expense');
                } else if (currentFilter === 'transfer') {
                    filteredTransactions = transactions.filter(t => t.type === 'transfer');
                }

                // Apply search filter
                const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
                if (searchTerm) {
                    filteredTransactions = filteredTransactions.filter(t => {
                        const description = (t.description || '').toLowerCase();
                        const category = (t.category || '').toLowerCase();
                        const amount = (t.amount || '').toString();
                        const accountName = t.account ? (accounts.find(a => a.id === t.account)?.name || '').toLowerCase() : '';
                        const fromAccountName = t.fromAccount ? (accounts.find(a => a.id === t.fromAccount)?.name || '').toLowerCase() : '';
                        const toAccountName = t.toAccount ? (accounts.find(a => a.id === t.toAccount)?.name || '').toLowerCase() : '';
                        
                        return description.includes(searchTerm) || 
                               category.includes(searchTerm) || 
                               amount.includes(searchTerm) ||
                               accountName.includes(searchTerm) ||
                               fromAccountName.includes(searchTerm) ||
                               toAccountName.includes(searchTerm);
                    });
                }

                // Sort by date (newest first)
                filteredTransactions.sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));

                el.innerHTML = filteredTransactions.map(t => {
                    if (t.type === 'transfer') {
                        // Display transfer transactions differently
                        const fromAccountName = accounts.find(a => a.id === t.fromAccount)?.name || 'Unknown';
                        const toAccountName = accounts.find(a => a.id === t.toAccount)?.name || 'Unknown';
                        
                        return `
                            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-3 hover:shadow-md transition-shadow">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900">${t.description || 'Transfer'}</p>
                                            <p class="text-sm text-gray-500">${fromAccountName} ‚Üí ${toAccountName} ‚Ä¢ ${t.date ? new Date(t.date).toLocaleDateString() : ''}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-lg text-blue-600">${currency}${Number(t.amount || 0).toFixed(2)}</p>
                                        <p class="text-xs text-gray-500">Transfer</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        // Regular income/expense transaction
                        const isIncome = t.type === 'income';
                        const amountColor = isIncome ? 'text-green-600' : 'text-red-600';
                        const bgColor = isIncome ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
                        const iconColor = isIncome ? 'text-green-500' : 'text-red-500';

                        return `
                            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-3 hover:shadow-md transition-shadow">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 ${bgColor} rounded-full flex items-center justify-center">
                                            <svg class="w-5 h-5 ${iconColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                ${isIncome ?
                                                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>' :
                                                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>'
                                                }
                                            </svg>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900">${t.description || t.category || 'Transaction'}</p>
                                            <p class="text-sm text-gray-500">${t.category || ''} ‚Ä¢ ${t.date ? new Date(t.date).toLocaleDateString() : ''}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-lg ${amountColor}">${isIncome ? '+' : '-'}${currency}${Number(t.amount || 0).toFixed(2)}</p>
                                        <p class="text-xs text-gray-500">${t.account ? accounts.find(a => a.id === t.account)?.name || 'Account' : 'Cash'}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }).join('');
            }

            function updateTotals() {
                let income = 0, expense = 0;
                (transactions || []).forEach(t => {
                    const amt = Number(t.amount || 0);
                    if (t.type === 'income') income += amt; else expense += amt;
                });
                const incomeEl = document.getElementById('totalIncome');
                const expenseEl = document.getElementById('totalExpense');
                const balanceEl = document.getElementById('balance');
                const budgetEl = document.getElementById('budgetLeft');
                if (incomeEl) incomeEl.textContent = currency + income.toFixed(2);
                if (expenseEl) expenseEl.textContent = currency + expense.toFixed(2);
                if (balanceEl) balanceEl.textContent = currency + (income - expense).toFixed(2);
                if (budgetEl) budgetEl.textContent = currency + '0.00';

                // Update financial position
                updateFinancialPosition();
            }

            function updateFinancialPosition() {
                const incomeSourcesEl = document.getElementById('incomeSourcesList');
                const liabilitiesEl = document.getElementById('liabilitiesList');
                const totalAssetsEl = document.getElementById('totalAssetsValue');
                const totalLiabilitiesEl = document.getElementById('totalLiabilitiesValue');
                const netWorthEl = document.getElementById('netWorthValue');

                if (!incomeSourcesEl || !liabilitiesEl) return;

                let totalAssets = 0;
                let totalLiabilities = 0;

                // Income Sources: Accounts with positive balances + Assets
                const incomeSources = [];
                const liabilities = [];

                // Add account balances
                (accounts || []).forEach(account => {
                    const balance = Number(account.balance || 0);
                    const accountType = account.type || 'cash';

                    if (balance > 0) {
                        // Positive balance = Asset/Income Source
                        incomeSources.push({
                            name: account.name,
                            type: accountType,
                            amount: balance,
                            category: 'account'
                        });
                        totalAssets += balance;
                    } else if (balance < 0) {
                        // Negative balance = Liability
                        liabilities.push({
                            name: account.name,
                            type: accountType,
                            amount: Math.abs(balance),
                            category: 'account'
                        });
                        totalLiabilities += Math.abs(balance);
                    }
                });

                // Add assets
                (assets || []).forEach(asset => {
                    const value = Number(asset.value || 0);
                    if (value > 0) {
                        incomeSources.push({
                            name: asset.name,
                            type: asset.category || 'asset',
                            amount: value,
                            category: 'asset'
                        });
                        totalAssets += value;
                    }
                });

                // Sort by amount (highest first)
                incomeSources.sort((a, b) => b.amount - a.amount);
                liabilities.sort((a, b) => b.amount - a.amount);

                // Get type icons and colors
                const getTypeInfo = (type, category) => {
                    if (category === 'asset') {
                        const assetIcons = {
                            'real-estate': { icon: 'üè†', color: 'text-green-600' },
                            'investment': { icon: 'üìà', color: 'text-purple-600' },
                            'vehicle': { icon: 'üöó', color: 'text-blue-600' },
                            'jewelry': { icon: 'üíç', color: 'text-yellow-600' },
                            'other': { icon: 'üí∞', color: 'text-gray-600' }
                        };
                        return assetIcons[type] || assetIcons['other'];
                    } else {
                        const accountIcons = {
                            'cash': { icon: 'üíµ', color: 'text-green-600' },
                            'bank': { icon: 'üè¶', color: 'text-blue-600' },
                            'credit': { icon: 'üí≥', color: 'text-red-600' },
                            'mtn-momo': { icon: 'üì±', color: 'text-yellow-600' },
                            'telecel-cash': { icon: 'üìû', color: 'text-purple-600' },
                            'investment': { icon: 'üìà', color: 'text-indigo-600' },
                            'asset': { icon: 'üè†', color: 'text-teal-600' },
                            'debt': { icon: 'üí∞', color: 'text-orange-600' }
                        };
                        return accountIcons[type] || accountIcons['cash'];
                    }
                };

                // Render income sources
                incomeSourcesEl.innerHTML = incomeSources.length > 0 ?
                    incomeSources.map(source => {
                        const typeInfo = getTypeInfo(source.type, source.category);
                        return `
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <span class="text-lg">${typeInfo.icon}</span>
                                    <div>
                                        <p class="font-medium text-gray-900">${source.name}</p>
                                        <p class="text-sm text-gray-500 capitalize">${source.type.replace('-', ' ')}</p>
                                    </div>
                                </div>
                                <span class="font-semibold text-gray-900">${currency}${source.amount.toFixed(2)}</span>
                            </div>
                        `;
                    }).join('') :
                    '<p class="text-gray-500 text-center py-4">No income sources yet</p>';

                // Render liabilities
                liabilitiesEl.innerHTML = liabilities.length > 0 ?
                    liabilities.map(liability => {
                        const typeInfo = getTypeInfo(liability.type, liability.category);
                        return `
                            <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <span class="text-lg">${typeInfo.icon}</span>
                                    <div>
                                        <p class="font-medium text-gray-900">${liability.name}</p>
                                        <p class="text-sm text-gray-500 capitalize">${liability.type.replace('-', ' ')}</p>
                                    </div>
                                </div>
                                <span class="font-semibold text-red-600">${currency}${liability.amount.toFixed(2)}</span>
                            </div>
                        `;
                    }).join('') :
                    '<p class="text-gray-500 text-center py-4">No liabilities</p>';

                // Update totals
                if (totalAssetsEl) totalAssetsEl.textContent = currency + totalAssets.toFixed(2);
                if (totalLiabilitiesEl) totalLiabilitiesEl.textContent = currency + totalLiabilities.toFixed(2);

                // Calculate and display net worth
                const netWorth = totalAssets - totalLiabilities;
                if (netWorthEl) {
                    netWorthEl.textContent = currency + netWorth.toFixed(2);
                    netWorthEl.className = netWorth >= 0 ? 'text-3xl font-bold text-green-400' : 'text-3xl font-bold text-red-400';
                }
            }

            // Lightweight helpers used by UI; full implementations can be restored later
            function switchTab(tab) {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));

                // Show selected tab content
                const target = document.getElementById('content' + tab.charAt(0).toUpperCase() + tab.slice(1));
                if (target) target.classList.remove('hidden');

                // Render content for specific tabs
                if (tab === 'accounts') {
                    renderAccounts();
                } else if (tab === 'assets') {
                    renderAssets();
                } else if (tab === 'reminders') {
                    renderReminders();
                } else if (tab === 'analytics') {
                    renderAnalytics();
                }

                // Update tab button styles
                document.querySelectorAll('[id^="tab"]').forEach(btn => {
                    if (btn.id === 'tab' + tab.charAt(0).toUpperCase() + tab.slice(1)) {
                        btn.classList.add('tab-active');
                        btn.classList.remove('text-gray-600');
                    } else {
                        btn.classList.remove('tab-active');
                        btn.classList.add('text-gray-600');
                    }
                });

                currentTab = tab;
            }

            function switchAccount() {
                currentAccount = document.getElementById('accountSelector').value;
                renderTransactions();
                updateTotals();
            }

            function openTransactionModal() { document.getElementById('transactionModal').classList.remove('hidden'); }
            function closeTransactionModal() { document.getElementById('transactionModal').classList.add('hidden'); }
            function openBudgetModal() { document.getElementById('budgetModal').classList.remove('hidden'); }
            function closeBudgetModal() { document.getElementById('budgetModal').classList.add('hidden'); }

            function addBudget() {
                const category = document.getElementById('budgetCategory').value;
                const amount = parseFloat(document.getElementById('budgetAmount').value);
                const period = document.getElementById('budgetPeriod').value;
                if (!category || isNaN(amount) || amount <= 0) {
                    alert('Please enter valid category and amount');
                    return;
                }
                budgets.push({ category, amount, period, spent: 0 });
                saveToFirebase();
                closeBudgetModal();
                // Optionally render budgets
            }

            function addTransaction() {
                const amount = parseFloat(document.getElementById('amount').value);
                const date = document.getElementById('date').value;
                const description = document.getElementById('description').value;
                
                if (isNaN(amount) || amount <= 0 || !date) {
                    alert('Please enter valid amount and date');
                    return;
                }

                if (currentType === 'transfer') {
                    // Handle transfer between accounts
                    const fromAccount = document.getElementById('fromAccountSelect').value;
                    const toAccount = document.getElementById('toAccountSelect').value;
                    
                    if (!fromAccount || !toAccount) {
                        alert('Please select both from and to accounts');
                        return;
                    }
                    
                    if (fromAccount === toAccount) {
                        alert('Cannot transfer to the same account');
                        return;
                    }

                    // Create transfer transaction (expense from source, income to destination)
                    const transferDesc = description || `Transfer from ${accounts.find(a => a.id === fromAccount)?.name || 'Account'} to ${accounts.find(a => a.id === toAccount)?.name || 'Account'}`;
                    
                    transactions.push({
                        type: 'transfer',
                        amount,
                        fromAccount,
                        toAccount,
                        date,
                        description: transferDesc,
                        id: Date.now().toString()
                    });
                    
                    // Update account balances
                    const fromAcc = accounts.find(a => a.id === fromAccount);
                    const toAcc = accounts.find(a => a.id === toAccount);
                    if (fromAcc) fromAcc.balance -= amount;
                    if (toAcc) toAcc.balance += amount;
                    
                } else {
                    // Handle regular income/expense
                    const category = document.getElementById('category').value;
                    const account = document.getElementById('accountSelect').value;
                    
                    if (!category || !account) {
                        alert('Please fill in required fields');
                        return;
                    }
                    
                    transactions.push({
                        type: currentType,
                        amount,
                        category,
                        account,
                        date,
                        description
                    });
                }
                
                saveToFirebase();
                closeTransactionModal();
                renderTransactions();
                updateTotals();
                renderAccounts();
                alert('Transaction added successfully!');
            }

            function setFilter(filter) {
                currentFilter = filter;
                renderTransactions();
            }

            function handleSearch() {
                renderTransactions();
            }

            function exportData() {
                alert('Export feature not implemented yet');
            }

            function openRecurringModal() { /* stub */ }
            function closeRecurringModal() { /* stub */ }
            function openAccountModal() { 
                document.getElementById('accountModal').classList.remove('hidden'); 
                // Clear form
                document.getElementById('accountName').value = '';
                document.getElementById('accountType').value = 'cash';
                document.getElementById('accountBalance').value = '';
            }
            function closeAccountModal() { 
                document.getElementById('accountModal').classList.add('hidden'); 
            }
            function openReminderModal() { 
                document.getElementById('reminderModal').classList.remove('hidden');
                // Clear form
                document.getElementById('reminderTitle').value = '';
                document.getElementById('reminderAmount').value = '';
                document.getElementById('reminderDate').value = '';
                document.getElementById('reminderFrequency').value = 'monthly';
            }
            function closeReminderModal() { 
                document.getElementById('reminderModal').classList.add('hidden'); 
            }
            function addAccount() { 
                const name = document.getElementById('accountName').value.trim();
                const type = document.getElementById('accountType').value;
                const balance = parseFloat(document.getElementById('accountBalance').value) || 0;

                if (!name) {
                    alert('Please enter an account name');
                    return;
                }

                // Check if account name already exists
                if (accounts.some(acc => acc.name.toLowerCase() === name.toLowerCase())) {
                    alert('An account with this name already exists');
                    return;
                }

                const newAccount = {
                    id: Date.now().toString(), // Simple ID generation
                    name: name,
                    type: type,
                    balance: balance
                };

                accounts.push(newAccount);
                saveToFirebase();
                closeAccountModal();
                updateAccountSelectors();
                renderAccounts();
                updateFinancialPosition();
                alert('Account added successfully!');
            }
            function addReminder() { 
                const title = document.getElementById('reminderTitle').value.trim();
                const amount = parseFloat(document.getElementById('reminderAmount').value);
                const date = document.getElementById('reminderDate').value;
                const frequency = document.getElementById('reminderFrequency').value;

                if (!title || !date) {
                    alert('Please enter title and date');
                    return;
                }

                const newReminder = {
                    id: Date.now().toString(),
                    title,
                    amount: amount || 0,
                    date,
                    frequency,
                    createdAt: new Date().toISOString()
                };

                reminders.push(newReminder);
                saveToFirebase();
                closeReminderModal();
                renderReminders();
                alert('Reminder added successfully!');
            }

            function openSettingsModal() {
                document.getElementById('settingsModal').classList.remove('hidden');
                // Set current currency in the select
                const currencySelect = document.getElementById('currencySelect');
                currencySelect.value = currency;
            }

            function closeSettingsModal() {
                document.getElementById('settingsModal').classList.add('hidden');
            }

            function saveSettings() {
                const newCurrency = document.getElementById('currencySelect').value;
                currency = newCurrency;
                // Update all displays
                updateTotals();
                renderTransactions();
                // Save to Firebase
                saveToFirebase();
                closeSettingsModal();
                alert('Settings saved successfully!');
            }

            function renderAccounts() {
                const el = document.getElementById('accountsList');
                if (!el) return;

                if (!accounts || accounts.length === 0) {
                    el.innerHTML = `
                        <div class="text-center py-8">
                            <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                            </svg>
                            <p class="text-gray-500 text-lg">No accounts yet</p>
                            <p class="text-gray-400 text-sm">Add your first account to start tracking</p>
                        </div>
                    `;
                    return;
                }

                el.innerHTML = accounts.map(account => {
                    const typeIcons = {
                        'cash': 'üíµ',
                        'bank': 'üè¶',
                        'credit': 'üí≥',
                        'mtn-momo': 'üì±',
                        'telecel-cash': 'üìû',
                        'investment': 'üìà',
                        'asset': 'üè†',
                        'debt': 'üí∞'
                    };

                    const typeColors = {
                        'cash': 'bg-green-100 text-green-800 border-green-200',
                        'bank': 'bg-blue-100 text-blue-800 border-blue-200',
                        'credit': 'bg-red-100 text-red-800 border-red-200',
                        'mtn-momo': 'bg-yellow-100 text-yellow-800 border-yellow-200',
                        'telecel-cash': 'bg-purple-100 text-purple-800 border-purple-200',
                        'investment': 'bg-indigo-100 text-indigo-800 border-indigo-200',
                        'asset': 'bg-teal-100 text-teal-800 border-teal-200',
                        'debt': 'bg-orange-100 text-orange-800 border-orange-200'
                    };

                    const icon = typeIcons[account.type] || 'üí∞';
                    const colorClass = typeColors[account.type] || 'bg-gray-100 text-gray-800 border-gray-200';
                    const balance = Number(account.balance || 0);
                    const isNegative = balance < 0;

                    return `
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-3 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 ${colorClass} rounded-full flex items-center justify-center text-lg">
                                        ${icon}
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-900">${account.name}</p>
                                        <p class="text-sm text-gray-500 capitalize">${account.type.replace('-', ' ')}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-lg ${isNegative ? 'text-red-600' : 'text-gray-900'}">
                                        ${currency}${balance.toFixed(2)}
                                    </p>
                                    <div class="flex space-x-2 mt-2">
                                        <button onclick="editAccount('${account.id}')" class="text-blue-600 hover:text-blue-800 text-sm">Edit</button>
                                        <button onclick="deleteAccount('${account.id}')" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            function editAccount(accountId) {
                const account = accounts.find(a => a.id === accountId);
                if (!account) return;

                // Populate modal with account data
                document.getElementById('accountName').value = account.name;
                document.getElementById('accountType').value = account.type;
                document.getElementById('accountBalance').value = account.balance;

                // Change button text and function
                const button = document.querySelector('#accountModal button[onclick*="addAccount"]');
                button.textContent = 'Update Account';
                button.setAttribute('onclick', `updateAccount('${accountId}')`);

                openAccountModal();
            }

            function updateAccount(accountId) {
                const name = document.getElementById('accountName').value.trim();
                const type = document.getElementById('accountType').value;
                const balance = parseFloat(document.getElementById('accountBalance').value) || 0;

                if (!name) {
                    alert('Please enter an account name');
                    return;
                }

                const accountIndex = accounts.findIndex(a => a.id === accountId);
                if (accountIndex === -1) return;

                // Check if account name already exists (excluding current account)
                if (accounts.some((acc, index) => index !== accountIndex && acc.name.toLowerCase() === name.toLowerCase())) {
                    alert('An account with this name already exists');
                    return;
                }

                accounts[accountIndex] = {
                    ...accounts[accountIndex],
                    name,
                    type,
                    balance
                };

                saveToFirebase();
                closeAccountModal();
                updateAccountSelectors();
                renderAccounts();
                updateFinancialPosition();
                alert('Account updated successfully!');
            }

            function deleteAccount(accountId) {
                if (!confirm('Are you sure you want to delete this account? This action cannot be undone.')) return;

                accounts = accounts.filter(a => a.id !== accountId);
                saveToFirebase();
                updateAccountSelectors();
                renderAccounts();
                updateFinancialPosition();
                alert('Account deleted successfully!');
            }

            // ============================================
            // ASSET MANAGEMENT FUNCTIONS
            // ============================================
            function renderAssets() {
                const el = document.getElementById('assetsList');
                if (!el) return;

                if (!assets || assets.length === 0) {
                    el.innerHTML = `
                        <div class="text-center py-8">
                            <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                            <p class="text-gray-500 text-lg">No assets yet</p>
                            <p class="text-gray-400 text-sm">Add your first asset to start tracking</p>
                        </div>
                    `;
                    updateAssetTotals();
                    return;
                }

                el.innerHTML = assets.map(asset => {
                    const categoryColors = {
                        'real-estate': 'bg-green-100 text-green-800 border-green-200',
                        'investment': 'bg-purple-100 text-purple-800 border-purple-200',
                        'vehicle': 'bg-blue-100 text-blue-800 border-blue-200',
                        'jewelry': 'bg-yellow-100 text-yellow-800 border-yellow-200',
                        'other': 'bg-gray-100 text-gray-800 border-gray-200'
                    };

                    const colorClass = categoryColors[asset.category] || categoryColors['other'];

                    return `
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-3 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 ${colorClass} rounded-full flex items-center justify-center">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            ${asset.category === 'real-estate' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>' :
                                              asset.category === 'investment' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>' :
                                              asset.category === 'vehicle' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>' :
                                              '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>'}
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-900">${asset.name}</p>
                                        <p class="text-sm text-gray-500 capitalize">${asset.category.replace('-', ' ')} ‚Ä¢ ${asset.purchaseDate ? new Date(asset.purchaseDate).toLocaleDateString() : ''}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-lg text-gray-900">${currency}${Number(asset.value || 0).toFixed(2)}</p>
                                    <div class="flex space-x-2 mt-2">
                                        <button onclick="editAsset('${asset.id}')" class="text-blue-600 hover:text-blue-800 text-sm">Edit</button>
                                        <button onclick="deleteAsset('${asset.id}')" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                updateAssetTotals();
            }

            function updateAssetTotals() {
                let totalAssets = 0;
                let realEstate = 0;
                let investments = 0;

                (assets || []).forEach(asset => {
                    const value = Number(asset.value || 0);
                    totalAssets += value;

                    if (asset.category === 'real-estate') {
                        realEstate += value;
                    } else if (asset.category === 'investment') {
                        investments += value;
                    }
                });

                const totalEl = document.getElementById('totalAssetsValue');
                const realEstateEl = document.getElementById('realEstateValue');
                const investmentsEl = document.getElementById('investmentsValue');

                if (totalEl) totalEl.textContent = currency + totalAssets.toFixed(2);
                if (realEstateEl) realEstateEl.textContent = currency + realEstate.toFixed(2);
                if (investmentsEl) investmentsEl.textContent = currency + investments.toFixed(2);
            }

            function openAssetModal(assetId = null) {
                const modal = document.getElementById('assetModal');
                if (!modal) return;

                modal.classList.remove('hidden');

                if (assetId) {
                    // Edit mode
                    const asset = assets.find(a => a.id === assetId);
                    if (asset) {
                        document.getElementById('assetName').value = asset.name || '';
                        document.getElementById('assetCategory').value = asset.category || 'other';
                        document.getElementById('assetValue').value = asset.value || '';
                        document.getElementById('assetPurchaseDate').value = asset.purchaseDate || '';
                        document.getElementById('assetDescription').value = asset.description || '';
                        document.getElementById('assetModalTitle').textContent = 'Edit Asset';
                        document.getElementById('assetSubmitBtn').textContent = 'Update Asset';
                        document.getElementById('assetSubmitBtn').onclick = () => updateAsset(assetId);
                    }
                } else {
                    // Add mode
                    document.getElementById('assetName').value = '';
                    document.getElementById('assetCategory').value = 'other';
                    document.getElementById('assetValue').value = '';
                    document.getElementById('assetPurchaseDate').value = '';
                    document.getElementById('assetDescription').value = '';
                    document.getElementById('assetModalTitle').textContent = 'Add New Asset';
                    document.getElementById('assetSubmitBtn').textContent = 'Add Asset';
                    document.getElementById('assetSubmitBtn').onclick = addAsset;
                }
            }

            function closeAssetModal() {
                const modal = document.getElementById('assetModal');
                if (modal) modal.classList.add('hidden');
            }

            function addAsset() {
                const name = document.getElementById('assetName').value.trim();
                const category = document.getElementById('assetCategory').value;
                const value = parseFloat(document.getElementById('assetValue').value);
                const purchaseDate = document.getElementById('assetPurchaseDate').value;
                const description = document.getElementById('assetDescription').value;

                if (!name || isNaN(value) || value <= 0) {
                    alert('Please enter valid asset name and value');
                    return;
                }

                const newAsset = {
                    id: Date.now().toString(),
                    name,
                    category,
                    value,
                    purchaseDate,
                    description
                };

                assets.push(newAsset);
                saveToFirebase();
                closeAssetModal();
                renderAssets();
                updateFinancialPosition();
                alert('Asset added successfully!');
            }

            function updateAsset(assetId) {
                const asset = assets.find(a => a.id === assetId);
                if (!asset) return;

                const name = document.getElementById('assetName').value.trim();
                const category = document.getElementById('assetCategory').value;
                const value = parseFloat(document.getElementById('assetValue').value);
                const purchaseDate = document.getElementById('assetPurchaseDate').value;
                const description = document.getElementById('assetDescription').value;

                if (!name || isNaN(value) || value <= 0) {
                    alert('Please enter valid asset name and value');
                    return;
                }

                asset.name = name;
                asset.category = category;
                asset.value = value;
                asset.purchaseDate = purchaseDate;
                asset.description = description;

                saveToFirebase();
                closeAssetModal();
                renderAssets();
                updateFinancialPosition();
                alert('Asset updated successfully!');
            }

            function editAsset(assetId) {
                openAssetModal(assetId);
            }

            function deleteAsset(assetId) {
                if (!confirm('Are you sure you want to delete this asset?')) return;

                assets = assets.filter(a => a.id !== assetId);
                saveToFirebase();
                renderAssets();
                updateFinancialPosition();
                alert('Asset deleted successfully!');
            }

            function renderAnalytics() {
                updateAnalytics();
            }

            function updateAnalytics() {
                const type = document.getElementById('analyticsType').value;
                const ctx = document.getElementById('analyticsChart').getContext('2d');
                const summaryEl = document.getElementById('analyticsSummary');

                // Destroy existing chart
                if (analyticsChart) {
                    analyticsChart.destroy();
                }

                let chartData = {};
                let chartConfig = {};

                if (type === 'category') {
                    // Spending by category
                    const categoryData = {};
                    transactions.filter(t => t.type === 'expense').forEach(t => {
                        const category = t.category || 'Uncategorized';
                        categoryData[category] = (categoryData[category] || 0) + Math.abs(t.amount);
                    });

                    chartConfig = {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(categoryData),
                            datasets: [{
                                data: Object.values(categoryData),
                                backgroundColor: [
                                    '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40',
                                    '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384', '#36A2EB', '#FFCE56'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                },
                                title: {
                                    display: true,
                                    text: 'Spending by Category'
                                }
                            }
                        }
                    };

                    summaryEl.innerHTML = `
                        <div class="bg-white rounded-xl shadow-md p-4">
                            <h3 class="text-lg font-semibold mb-3">Category Breakdown</h3>
                            ${Object.entries(categoryData).map(([category, amount]) => `
                                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                    <span class="text-gray-700">${category}</span>
                                    <span class="font-semibold text-gray-900">${currency}${amount.toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;

                } else if (type === 'monthly') {
                    // Monthly trend
                    const monthlyData = {};
                    transactions.forEach(t => {
                        const date = new Date(t.date);
                        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                        if (!monthlyData[monthKey]) {
                            monthlyData[monthKey] = { income: 0, expense: 0 };
                        }
                        if (t.type === 'income') {
                            monthlyData[monthKey].income += t.amount;
                        } else if (t.type === 'expense') {
                            monthlyData[monthKey].expense += Math.abs(t.amount);
                        }
                    });

                    const sortedMonths = Object.keys(monthlyData).sort();
                    
                    chartConfig = {
                        type: 'line',
                        data: {
                            labels: sortedMonths.map(month => {
                                const [year, monthNum] = month.split('-');
                                return `${year}-${monthNum}`;
                            }),
                            datasets: [{
                                label: 'Income',
                                data: sortedMonths.map(month => monthlyData[month].income),
                                borderColor: '#10B981',
                                backgroundColor: '#10B98120',
                                tension: 0.4
                            }, {
                                label: 'Expenses',
                                data: sortedMonths.map(month => monthlyData[month].expense),
                                borderColor: '#EF4444',
                                backgroundColor: '#EF444420',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Monthly Income vs Expenses'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return currency + value.toFixed(0);
                                        }
                                    }
                                }
                            }
                        }
                    };

                    summaryEl.innerHTML = `
                        <div class="bg-white rounded-xl shadow-md p-4">
                            <h3 class="text-lg font-semibold mb-3">Monthly Summary</h3>
                            ${sortedMonths.map(month => {
                                const data = monthlyData[month];
                                const net = data.income - data.expense;
                                return `
                                    <div class="flex justify-between items-center py-2 border-b border-gray-100">
                                        <span class="text-gray-700">${month}</span>
                                        <div class="text-right">
                                            <div class="text-sm text-green-600">+${currency}${data.income.toFixed(2)}</div>
                                            <div class="text-sm text-red-600">-${currency}${data.expense.toFixed(2)}</div>
                                            <div class="font-semibold ${net >= 0 ? 'text-green-600' : 'text-red-600'}">
                                                ${net >= 0 ? '+' : ''}${currency}${net.toFixed(2)}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;

                } else if (type === 'comparison') {
                    // Income vs Expense comparison
                    const totalIncome = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                    const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + Math.abs(t.amount), 0);
                    
                    chartConfig = {
                        type: 'bar',
                        data: {
                            labels: ['Income', 'Expenses'],
                            datasets: [{
                                data: [totalIncome, totalExpense],
                                backgroundColor: ['#10B981', '#EF4444'],
                                borderColor: ['#059669', '#DC2626'],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: 'Total Income vs Expenses'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return currency + value.toFixed(0);
                                        }
                                    }
                                }
                            }
                        }
                    };

                    const netIncome = totalIncome - totalExpense;
                    summaryEl.innerHTML = `
                        <div class="bg-white rounded-xl shadow-md p-4">
                            <h3 class="text-lg font-semibold mb-3">Financial Overview</h3>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600">${currency}${totalIncome.toFixed(2)}</div>
                                    <div class="text-sm text-gray-600">Total Income</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-red-600">${currency}${totalExpense.toFixed(2)}</div>
                                    <div class="text-sm text-gray-600">Total Expenses</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold ${netIncome >= 0 ? 'text-green-600' : 'text-red-600'}">${netIncome >= 0 ? '+' : ''}${currency}${netIncome.toFixed(2)}</div>
                                    <div class="text-sm text-gray-600">Net Income</div>
                                </div>
                            </div>
                        </div>
                    `;
                }

                analyticsChart = new Chart(ctx, chartConfig);
            }

            // End of script - ensure HTML is properly closed
        </script>

    </body>
    </html>
