<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker Pro - Cloud Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .tab-active { border-bottom: 3px solid #4f46e5; color: #4f46e5; font-weight: 600; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #4f46e5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-white to-purple-50 min-h-screen">
    
    <!-- Firebase Configuration Notice -->
    <div id="firebaseNotice" class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
        <div class="max-w-6xl mx-auto">
            <p class="text-sm text-yellow-700">
                ⚠️ <strong>Firebase Setup Required:</strong> Please configure your Firebase credentials in the JavaScript section below. 
                <a href="#setup-instructions" class="underline font-semibold">See setup instructions</a>
            </p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Budget Tracker Pro</h1>
                <p class="text-gray-600">Cloud-synced expense tracking</p>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="space-y-4">
                <input type="email" id="loginEmail" placeholder="Email" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                <input type="password" id="loginPassword" placeholder="Password" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                <button onclick="loginUser()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                    Sign In
                </button>
                <button onclick="showRegisterForm()" class="w-full bg-white text-indigo-600 border-2 border-indigo-600 py-3 rounded-lg font-semibold hover:bg-indigo-50">
                    Create Account
                </button>
                <div id="loginError" class="text-red-600 text-sm text-center hidden"></div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="space-y-4 hidden">
                <input type="email" id="registerEmail" placeholder="Email" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                <input type="password" id="registerPassword" placeholder="Password (min 6 characters)" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                <input type="password" id="registerPasswordConfirm" placeholder="Confirm Password" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                <button onclick="registerUser()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg">
                    Create Account
                </button>
                <button onclick="showLoginForm()" class="w-full bg-white text-gray-600 border-2 border-gray-300 py-3 rounded-lg font-semibold hover:bg-gray-50">
                    Back to Login
                </button>
                <div id="registerError" class="text-red-600 text-sm text-center hidden"></div>
            </div>

            <!-- Loading Spinner -->
            <div id="authLoading" class="hidden text-center">
                <div class="spinner mx-auto mb-4"></div>
                <p class="text-gray-600">Please wait...</p>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden until logged in) -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-lg">
            <div class="max-w-6xl mx-auto p-4">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-2">
                        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                        <h1 class="text-2xl font-bold">Budget Tracker Pro</h1>
                    </div>
                    <div class="flex gap-2 items-center">
                        <span id="userEmail" class="text-sm opacity-90 hidden md:block"></span>
                        <button onclick="exportData()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg text-sm">Export</button>
                        <button onclick="logoutUser()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg text-sm">Logout</button>
                    </div>
                </div>

                <!-- Sync Status -->
                <div id="syncStatus" class="text-xs opacity-75 mb-3 flex items-center gap-2">
                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                    <span>Synced</span>
                </div>

                <!-- Account Selector -->
                <div class="mb-4">
                    <select id="accountSelector" onchange="switchAccount()" class="bg-white/20 text-white border border-white/30 rounded-lg px-4 py-2 w-full backdrop-blur-sm">
                        <option value="default">All Accounts</option>
                    </select>
                </div>

                <!-- Balance Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 border border-white/20">
                        <div class="text-xs opacity-90 mb-1">Income</div>
                        <p id="totalIncome" class="text-xl font-bold">$0.00</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 border border-white/20">
                        <div class="text-xs opacity-90 mb-1">Expenses</div>
                        <p id="totalExpense" class="text-xl font-bold">$0.00</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 border border-white/20">
                        <div class="text-xs opacity-90 mb-1">Balance</div>
                        <p id="balance" class="text-xl font-bold">$0.00</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-xl p-3 border border-white/20">
                        <div class="text-xs opacity-90 mb-1">Budget Left</div>
                        <p id="budgetLeft" class="text-xl font-bold">$0.00</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="bg-white shadow-sm sticky top-0 z-10">
            <div class="max-w-6xl mx-auto flex overflow-x-auto">
                <button onclick="switchTab('transactions')" id="tabTransactions" class="tab-active px-4 py-3 text-sm whitespace-nowrap">Transactions</button>
                <button onclick="switchTab('budgets')" id="tabBudgets" class="px-4 py-3 text-sm text-gray-600 whitespace-nowrap">Budgets</button>
                <button onclick="switchTab('analytics')" id="tabAnalytics" class="px-4 py-3 text-sm text-gray-600 whitespace-nowrap">Analytics</button>
                <button onclick="switchTab('recurring')" id="tabRecurring" class="px-4 py-3 text-sm text-gray-600 whitespace-nowrap">Recurring</button>
                <button onclick="switchTab('accounts')" id="tabAccounts" class="px-4 py-3 text-sm text-gray-600 whitespace-nowrap">Accounts</button>
                <button onclick="switchTab('reminders')" id="tabReminders" class="px-4 py-3 text-sm text-gray-600 whitespace-nowrap">Reminders</button>
            </div>
        </div>

        <!-- Main Content Container -->
        <div class="max-w-6xl mx-auto p-4">
            <!-- Transactions Tab -->
            <div id="contentTransactions" class="tab-content">
                <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
                    <div class="flex gap-2">
                        <button onclick="setFilter('all')" id="filterAll" class="px-3 py-2 text-sm rounded-lg bg-indigo-600 text-white">All</button>
                        <button onclick="setFilter('income')" id="filterIncome" class="px-3 py-2 text-sm rounded-lg bg-white text-gray-700">Income</button>
                        <button onclick="setFilter('expense')" id="filterExpense" class="px-3 py-2 text-sm rounded-lg bg-white text-gray-700">Expense</button>
                    </div>
                    <button onclick="openTransactionModal()" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">+ Add</button>
                </div>
                <div id="transactionsList" class="bg-white rounded-xl shadow-md"></div>
            </div>

            <!-- Budgets Tab -->
            <div id="contentBudgets" class="tab-content hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Category Budgets</h2>
                    <button onclick="openBudgetModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm">+ Add Budget</button>
                </div>
                <div id="budgetsList"></div>
            </div>

            <!-- Analytics Tab -->
            <div id="contentAnalytics" class="tab-content hidden">
                <div class="mb-4">
                    <select id="analyticsType" onchange="updateAnalytics()" class="px-4 py-2 border rounded-lg">
                        <option value="category">By Category</option>
                        <option value="monthly">Monthly Trend</option>
                        <option value="comparison">Income vs Expense</option>
                    </select>
                </div>
                <div class="bg-white rounded-xl shadow-md p-4">
                    <canvas id="analyticsChart"></canvas>
                </div>
                <div id="analyticsSummary" class="mt-4"></div>
            </div>

            <!-- Recurring Tab -->
            <div id="contentRecurring" class="tab-content hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Recurring Transactions</h2>
                    <button onclick="openRecurringModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm">+ Add Recurring</button>
                </div>
                <div id="recurringList"></div>
            </div>

            <!-- Accounts Tab -->
            <div id="contentAccounts" class="tab-content hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Accounts & Assets</h2>
                    <button onclick="openAccountModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm">+ Add Account</button>
                </div>
                <div id="accountsList"></div>
            </div>

            <!-- Reminders Tab -->
            <div id="contentReminders" class="tab-content hidden">
                <div class="mb-4 flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Bill Reminders</h2>
                    <button onclick="openReminderModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm">+ Add Reminder</button>
                </div>
                <div id="remindersList"></div>
            </div>
        </div>
    </div>

    <!-- All Modals (Transaction, Budget, Account, Reminder) - Same as before -->
    <div id="transactionModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 my-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Add Transaction</h2>
                <button onclick="closeTransactionModal()" class="text-gray-400 hover:text-gray-600">✕</button>
            </div>
            <div class="space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="setType('income')" id="typeIncome" class="p-3 rounded-lg border-2 border-gray-200">Income</button>
                    <button onclick="setType('expense')" id="typeExpense" class="p-3 rounded-lg border-2 border-red-500 bg-red-50 text-red-700">Expense</button>
                </div>
                <input type="number" id="amount" step="0.01" placeholder="Amount" class="w-full px-4 py-3 border rounded-lg">
                <select id="category" class="w-full px-4 py-3 border rounded-lg"></select>
                <select id="accountSelect" class="w-full px-4 py-3 border rounded-lg"></select>
                <input type="date" id="date" class="w-full px-4 py-3 border rounded-lg">
                <input type="text" id="description" placeholder="Description (optional)" class="w-full px-4 py-3 border rounded-lg">
                <button onclick="addTransaction()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-semibold">Add Transaction</button>
            </div>
        </div>
    </div>

    <div id="budgetModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Set Budget</h2>
                <button onclick="closeBudgetModal()" class="text-gray-400 hover:text-gray-600">✕</button>
            </div>
            <div class="space-y-3">
                <select id="budgetCategory" class="w-full px-4 py-3 border rounded-lg"></select>
                <input type="number" id="budgetAmount" step="0.01" placeholder="Budget Amount" class="w-full px-4 py-3 border rounded-lg">
                <select id="budgetPeriod" class="w-full px-4 py-3 border rounded-lg">
                    <option value="monthly">Monthly</option>
                    <option value="weekly">Weekly</option>
                    <option value="yearly">Yearly</option>
                </select>
                <button onclick="addBudget()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold">Set Budget</button>
            </div>
        </div>
    </div>

    <div id="accountModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Add Account</h2>
                <button onclick="closeAccountModal()" class="text-gray-400 hover:text-gray-600">✕</button>
            </div>
            <div class="space-y-3">
                <input type="text" id="accountName" placeholder="Account Name" class="w-full px-4 py-3 border rounded-lg">
                <select id="accountType" class="w-full px-4 py-3 border rounded-lg">
                    <option value="cash">Cash</option>
                    <option value="bank">Bank Account</option>
                    <option value="credit">Credit Card</option>
                    <option value="investment">Investment</option>
                    <option value="asset">Asset</option>
                    <option value="debt">Debt</option>
                </select>
                <input type="number" id="accountBalance" step="0.01" placeholder="Initial Balance" class="w-full px-4 py-3 border rounded-lg">
                <button onclick="addAccount()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold">Add Account</button>
            </div>
        </div>
    </div>

    <div id="reminderModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Add Reminder</h2>
                <button onclick="closeReminderModal()" class="text-gray-400 hover:text-gray-600">✕</button>
            </div>
            <div class="space-y-3">
                <input type="text" id="reminderTitle" placeholder="Bill Name" class="w-full px-4 py-3 border rounded-lg">
                <input type="number" id="reminderAmount" step="0.01" placeholder="Amount" class="w-full px-4 py-3 border rounded-lg">
                <input type="date" id="reminderDate" class="w-full px-4 py-3 border rounded-lg">
                <select id="reminderFrequency" class="w-full px-4 py-3 border rounded-lg">
                    <option value="once">One-time</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                </select>
                <button onclick="addReminder()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold">Add Reminder</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        // REPLACE THESE VALUES WITH YOUR OWN FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAocH0mqZA5iUXgq_BeTfGqV1cuUbWRntY",
    authDomain: "budget-tracker-91bcc.firebaseapp.com",
    databaseURL: "https://budget-tracker-91bcc-default-rtdb.firebaseio.com",
    projectId: "budget-tracker-91bcc",
    storageBucket: "budget-tracker-91bcc.firebasestorage.app",
    messagingSenderId: "657417341954",
    appId: "1:657417341954:web:08972dae3623bdd61f6b1b",
    measurementId: "G-BV3C6NY0B1"
        };

        // Initialize Firebase
        let app, auth, db, currentUser = null;
        
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            console.log('Firebase initialized successfully');
            document.getElementById('firebaseNotice').classList.add('hidden');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            alert('Firebase configuration needed. Please see setup instructions below.');
        }

        // ============================================
        // APP STATE
        // ============================================
        let transactions = [];
        let budgets = [];
        let accounts = [{id: 'default', name: 'Cash', type: 'cash', balance: 0}];
        let recurring = [];
        let reminders = [];
        let currentFilter = 'all';
        let currentType = 'expense';
        let currentTab = 'transactions';
        let currentAccount = 'default';
        let currency = '$';
        let analyticsChart = null;

        const categories = {
            income: ['Salary', 'Freelance', 'Business', 'Investment', 'Gift', 'Other'],
            expense: ['Food', 'Transport', 'Shopping', 'Bills', 'Entertainment', 'Health', 'Education', 'Other']
        };

        // ============================================
        // AUTHENTICATION
        // ============================================
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                document.getElementById('userEmail').textContent = user.email;
                loadFirebaseData();
            } else {
                currentUser = null;
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
        });

        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        async function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');

            if (!email || !password) {
                errorEl.textContent = 'Please enter email and password';
                errorEl.classList.remove('hidden');
                return;
            }

            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('authLoading').classList.remove('hidden');

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.classList.remove('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('authLoading').classList.add('hidden');
            }
        }

        async function registerUser() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            const errorEl = document.getElementById('registerError');

            if (!email || !password) {
                errorEl.textContent = 'Please enter email and password';
                errorEl.classList.remove('hidden');
                return;
            }

            if (password.length < 6) {
                errorEl.textContent = 'Password must be at least 6 characters';
                errorEl.classList.remove('hidden');
                return;
            }

            if (password !== passwordConfirm) {
                errorEl.textContent = 'Passwords do not match';
                errorEl.classList.remove('hidden');
                return;
            }

            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('authLoading').classList.remove('hidden');

            try {
                await auth.createUserWithEmailAndPassword(email, password);
            } catch (error) {
                errorEl.textContent = error.message;
                errorEl.classList.remove('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
                document.getElementById('authLoading').classList.add('hidden');
            }
        }

        async function logoutUser() {
            if (confirm('Are you sure you want to logout?')) {
                await auth.signOut();
            }
        }

        // ============================================
        // FIREBASE DATA OPERATIONS
        // ============================================
        function setSyncStatus(message, isError = false) {
            const el = document.getElementById('syncStatus');
            el.innerHTML = `
                <div class="w-2 h-2 ${isError ? 'bg-red-400' : 'bg-green-400'} rounded-full"></div>
                <span>${message}</span>
            `;
        }

        async function loadFirebaseData() {
            if (!currentUser) return;
            
            setSyncStatus('Loading...');
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                
                if (userDoc.exists) {
                    const data = userDoc.data();
                    transactions = data.transactions || [];
                    budgets = data.budgets || [];
                    accounts = data.accounts || [{id: 'default', name: 'Cash', type: 'cash', balance: 0}];
                    recurring = data.recurring || [];
                    reminders = data.reminders || [];
                    currency = data.currency || '$';
                }
                
                init();
                setSyncStatus('Synced');
            } catch (error) {
                console.error('Load error:', error);
                setSyncStatus('Error loading data', true);
            }
        }

        async function saveToFirebase() {
            if (!currentUser) return;
            
            setSyncStatus('Syncing...');
            
            try {
                await db.collection('users').doc(currentUser.uid).set({
                    transactions,
                    budgets,
                    accounts,
                    recurring,
                    reminders,
                    currency,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                setSyncStatus('Synced');
            } catch (error) {
                console.error('Save error:', error);
                setSyncStatus('Sync failed', true);
            }
        }

        // ============================================
        // APP INITIALIZATION
        // ============================================
        function init() {
            document.getElementById('date').valueAsDate = new Date();
            updateCategories();
            updateAccountSelectors();
            renderTransactions();
            updateTotals();
        }

        // ============================================
        // CORE FUNCTIONS (Same as before but with saveToFirebase())
        // ============================================
        function setType(type) {
            currentType = type;
            document.getElementById('typeIncome').className = type === 'income' 
                ? 'p-3 rounded-lg border-2 border-green-500 bg-green-50 text-green-700'
                : 'p-3 rounded-lg border-2 border-gray-200';
            document.getElementById('typeExpense').className = type === 'expense'
                ? 'p-3 rounded-lg border-2 border-red-500 bg-red-50 text-red-700'
                : 'p-3 rounded-lg border-2 border-gray-200';
            updateCategories();
        }

        function updateCategories() {
            const select = document.getElementById('category');
            const budgetSelect = document.getElementById('budgetCategory');
            select.innerHTML = '<option value="">Select category</option>';
            budgetSelect.innerHTML = '<option value="">Select category</option>';
            categories[currentType].forEach(cat => {
                select.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
            categories.expense.forEach(cat => {
                budgetSelect.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
        }

        function updateAccountSelectors() {
            const selectors = ['accountSelect', 'accountSelector'];
            selectors.forEach(id => {
                const el = document.getElementById(id);
                const current = el.value;
                el.innerHTML = id === 'account
